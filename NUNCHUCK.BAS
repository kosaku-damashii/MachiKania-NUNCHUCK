REM NUNCHUCK.BAS

USEVAR DA,SX,SY,GX,GY,GZ,BC,BZ
DIM DA(6)

I2C 100: REM Set I2C Baudrate 100KHz
I2CWRITE $52,$40,$00

WHILE 1
 I2CREADDATA $52,DA,6

 SX = GOSUB(DECODE,PEEK(DA))
 SY = GOSUB(DECODE,PEEK(DA+1))

 A = GOSUB(DECODE,PEEK(DA+5))
 BC = GOSUB(BITREAD,A,1)
 BZ = GOSUB(BITREAD,A,0)

 GX = (GOSUB(DECODE,PEEK(DA+2)) << 2) OR ((A AND $0C) >> 2)
 GY = (GOSUB(DECODE,PEEK(DA+3)) << 2) OR ((A AND $30) >> 4)
 GZ = (GOSUB(DECODE,PEEK(DA+4)) << 2) OR ((A AND $C0) >> 6)

 PRINT "C=";BC;" Z=";BZ;" x=";SX;" y=";SY;" X=";GX;" Y=";GY;" Z=";GZ

 I2CWRITE $52,0
 DELAYMS 100
WEND

END

LABEL DECODE
RETURN (ARGS(1) XOR $17) + $17

LABEL BITREAD
RETURN (ARGS(1) AND (1 << (ARGS(2)))) >> ARGS(2)
