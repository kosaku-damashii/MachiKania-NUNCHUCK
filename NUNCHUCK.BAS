REM NUNCHUCK.BAS

USEVAR COUNT,RD,DA,SX,SY,GX,GY,GZ,BC,BZ

I2C 100:REM Set I2C Baudrate 100KHz

DIM DA(6)

I2CWRITE $52,$40,$00

WHILE 1
 I2CREADDATA $52,DA,6
 FOR COUNT=0 TO 5
  A=(PEEK(DA+COUNT) XOR $17) + $17
  POKE DA+COUNT,A
 NEXT

 SX=PEEK(DA)
 SY=PEEK(DA+1)


 BC=GOSUB(BITREAD,PEEK(DA+5),1)
 BZ=GOSUB(BITREAD,PEEK(DA+5),0)

 GX = (PEEK(DA+2) << 2) OR ((PEEK(DA+5) AND $0C) >> 2)
 GY = (PEEK(DA+3) << 2) OR ((PEEK(DA+5) AND $30) >> 4)
 GZ = (PEEK(DA+4) << 2) OR ((PEEK(DA+5) AND $C0) >> 6)

 PRINT "C=";BC;" Z=";BZ;" x=";SX;" y=";SY;" X=";GX;" Y=";GY;" Z=";GZ

 I2CWRITE $52,0
 DELAYMS 10
WEND

END

LABEL BITREAD
 R = ARGS(1)
 R = R AND (1 << (ARGS(2)))
 R = R >> ARGS(2)
RETURN R
